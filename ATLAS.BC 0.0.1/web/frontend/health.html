<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blockchain Health Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e0 100%);
            min-height: 100vh;
            color: #1a202c;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(72, 187, 120, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(66, 153, 225, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            color: #1a202c;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 50%, #718096 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.01em;
        }

        .header p {
            font-size: 1.1rem;
            color: #4a5568;
            font-weight: 500;
        }

        .back-btn {
            background: rgba(45, 55, 72, 0.8);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 12px 22px;
            border-radius: 12px;
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
            letter-spacing: 0.01em;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .back-btn:hover {
            transform: translateY(-2px);
            background: rgba(45, 55, 72, 0.9);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }

        .nav {
            background: rgba(255,255,255,0.1);
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav a {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.1);
        }

        .nav a:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 
                0 20px 40px rgba(0,0,0,0.08),
                0 8px 16px rgba(0,0,0,0.06),
                inset 0 1px 0 rgba(255,255,255,0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 25px 50px rgba(0,0,0,0.12),
                0 12px 24px rgba(0,0,0,0.08),
                inset 0 1px 0 rgba(255,255,255,0.9);
        }

        .card h3 {
            color: #2d3748;
            margin-bottom: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            letter-spacing: -0.01em;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-online { background-color: #4CAF50; }
        .status-offline { background-color: #f44336; }
        .status-connecting { background-color: #ff9800; }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-weight: 500;
            color: #666;
        }

        .metric-value {
            font-weight: 600;
            color: #333;
        }

        .blocks-container {
            max-height: 300px;
            overflow-y: auto;
        }

        .block-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .block-hash {
            font-family: monospace;
            font-size: 0.9rem;
            color: #666;
            word-break: break-all;
        }

        .block-number {
            font-weight: 600;
            color: #667eea;
        }

        .transaction-item {
            background: #f0f8ff;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .controls {
            display: flex;
            flex-direction: row;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: nowrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* Monitoring Styles */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .metric-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
        }

        .metric-label {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 12px;
        }

        .metric-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-healthy {
            background: #d4edda;
            color: #155724;
        }

        .status-warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        .health-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .health-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .health-card h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }

        .health-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .dot-healthy { background: #28a745; }
        .dot-warning { background: #ffc107; }
        .dot-error { background: #dc3545; }

        .alert-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .alert-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .alert-level {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .level-info { background: #d1ecf1; color: #0c5460; }
        .level-warning { background: #fff3cd; color: #856404; }
        .level-error { background: #f8d7da; color: #721c24; }
        .level-critical { background: #f5c6cb; color: #721c24; }

        .trends-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .trend-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            border-radius: 6px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
        }
        
        .trend-icon {
            font-size: 1.2rem;
        }
        
        .trend-label {
            flex: 1;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .trend-value {
            font-size: 0.8rem;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 12px;
        }
        
        .trend-increasing {
            background: #d4edda;
            color: #155724;
        }
        
        .trend-decreasing {
            background: #f8d7da;
            color: #721c24;
        }
        
        .trend-stable {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .data-points-info {
            font-size: 0.75rem;
            color: #6c757d;
            text-align: center;
            margin-top: 8px;
            padding: 4px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .alert-message {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .alert-time {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .chart-container {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .chart-placeholder {
            height: 200px;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-style: italic;
        }

        .uptime-display {
            font-size: 1rem;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
        }

        .version-info {
            font-size: 0.8rem;
            color: #6c757d;
            margin-bottom: 15px;
        }

        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .status.show {
            transform: translateX(0);
        }

        .status.success {
            background: #28a745;
        }

        .status.error {
            background: #dc3545;
        }

        .status.info {
            background: #17a2b8;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 15px;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        /* Backup System Styles */
        .backup-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #e2e8f0;
        }

        .backup-item {
            display: grid;
            grid-template-columns: 1fr auto auto auto auto;
            gap: 10px;
            align-items: center;
            padding: 10px;
            border: 1px solid #f0f0f0;
            border-radius: 6px;
            margin-bottom: 8px;
            transition: background-color 0.3s ease;
            font-size: 0.85rem;
        }

        .backup-item:hover {
            background-color: #f8f9fa;
        }

        .backup-item:last-child {
            margin-bottom: 0;
        }

        .backup-id {
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            color: #667eea;
            font-weight: 600;
        }

        .backup-timestamp {
            color: #666;
            font-size: 0.8rem;
        }

        .backup-size {
            font-weight: 600;
            color: #333;
        }

        .backup-status {
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 0.7rem;
            font-weight: 500;
            text-transform: uppercase;
        }

        .status-created { background-color: #E3F2FD; color: #1976D2; }
        .status-verified { background-color: #E8F5E8; color: #388E3C; }
        .status-corrupted { background-color: #FFEBEE; color: #D32F2F; }
        .status-unknown { background-color: #F5F5F5; color: #757575; }

        .loading {
            text-align: center;
            padding: 15px;
            color: #666;
            font-size: 0.9rem;
        }

        .error {
            background-color: #FFEBEE;
            color: #D32F2F;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 3px solid #D32F2F;
            font-size: 0.85rem;
        }

        .success {
            background-color: #E8F5E8;
            color: #388E3C;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 3px solid #388E3C;
            font-size: 0.85rem;
        }

        /* Privacy & Security Styles */
        .privacy-section {
            margin-top: 20px;
        }
        
        .privacy-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 8px 10px;
            min-width: 0;
            overflow: hidden;
            width: 100%;
            box-sizing: border-box;
        }
        
        .privacy-card h4 {
            color: #1e3c72;
            margin-bottom: 6px;
            font-size: 0.92rem;
        }
        
        .result {
            margin-top: 15px;
            padding: 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        
        /* Enhanced Network Statistics Styles */
        .stat-card {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }
        
        .stat-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #4299e1;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 0.7rem;
            color: #6c757d;
        }
        
        .transaction-list {
            max-height: 120px;
            overflow-y: auto;
            font-size: 0.7rem;
        }
        
        .transaction-item {
            padding: 4px 0;
            border-bottom: 1px solid #f1f3f4;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .transaction-item:hover {
            background-color: #f8f9fa;
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>Health Dashboard</h1>
                <p>System health monitoring, performance metrics, and blockchain testing</p>
            </div>
            <a href="index.html" class="back-btn">‚Üê Back to Dashboard</a>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; align-items: stretch;">
            <!-- Enhanced System Overview & Blockchain Status (merged with Network Statistics) -->
            <div class="card top-row" style="min-height:280px; padding:16px 18px; max-width: 500px; height:100%;">
                <h3 style="font-size:1.1rem;">üè• System Overview & Blockchain Status</h3>
                <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:12px;">
                    <div style="display:flex; flex-direction:column;">
                        <div class="uptime-display" id="uptime" style="font-size:0.95rem;">Uptime: Loading...</div>
                        <div class="version-info" id="version" style="font-size:0.75rem;">Version: Loading...</div>
                    </div>
                    <button class="refresh-btn" onclick="loadSystemStatus();loadBlockchainStatus();loadRecentTransactions();" style="font-size:0.85rem; padding:6px 12px; margin-bottom:0;">üîÑ Refresh Status</button>
                </div>
                
                <!-- Enhanced Network Statistics Grid -->
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 12px;">
                    <div class="stat-card" style="background: #f8f9fa; padding: 8px; border-radius: 6px; text-align: center;">
                        <div class="stat-value" id="total-blocks" style="font-size: 1.1rem; font-weight: bold; color: #4299e1;">-</div>
                        <div class="stat-label" style="font-size: 0.7rem; color: #6c757d;">Total Blocks</div>
                    </div>
                    <div class="stat-card" style="background: #f8f9fa; padding: 8px; border-radius: 6px; text-align: center;">
                        <div class="stat-value" id="total-transactions" style="font-size: 1.1rem; font-weight: bold; color: #4299e1;">-</div>
                        <div class="stat-label" style="font-size: 0.7rem; color: #6c757d;">Total Transactions</div>
                    </div>
                    <div class="stat-card" style="background: #f8f9fa; padding: 8px; border-radius: 6px; text-align: center;">
                        <div class="stat-value" id="active-validators" style="font-size: 1.1rem; font-weight: bold; color: #4299e1;">-</div>
                        <div class="stat-label" style="font-size: 0.7rem; color: #6c757d;">Active Validators</div>
                    </div>
                    <div class="stat-card" style="background: #f8f9fa; padding: 8px; border-radius: 6px; text-align: center;">
                        <div class="stat-value" id="pool-size" style="font-size: 1.1rem; font-weight: bold; color: #4299e1;">-</div>
                        <div class="stat-label" style="font-size: 0.7rem; color: #6c757d;">Pool Size</div>
                    </div>
                </div>
                
                <!-- Connection Status -->
                <div id="blockchain-status" style="margin-bottom: 12px;">
                    <div class="metric" style="font-size: 0.75rem;">
                        <span class="metric-label">Connection Status:</span>
                        <span class="metric-value" style="font-size: 0.75rem;">
                            <span class="status-indicator status-connecting"></span>
                            <span style="font-size: 0.75rem;">Connecting...</span>
                        </span>
                    </div>
                </div>
                
                <!-- Recent Transactions Section -->
                <div style="border-top: 1px solid #e9ecef; padding-top: 8px;">
                    <h4 style="font-size: 0.85rem; margin-bottom: 8px; color: #495057;">üìã Recent Transactions</h4>
                    <div class="transaction-list" id="recent-transactions" style="max-height: 120px; overflow-y: auto; font-size: 0.7rem;">
                        <div class="transaction-item" style="padding: 4px 0; border-bottom: 1px solid #f1f3f4;">
                            <div style="color: #6c757d;">Loading transactions...</div>
                        </div>
                    </div>
                </div>
            </div>

        <!-- Health Checks -->
            <div class="card top-row" style="min-height:140px; padding:16px 18px; max-width: 500px; height:100%;">
                <h3 style="font-size:1.1rem;">üè• Health Checks</h3>
                <div class="health-list" id="health-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; align-items: stretch; min-height: 180px;">
                    <!-- Expanded Health Checks as grid -->
                    <div class="health-card" style="display:flex; flex-direction:column; justify-content:space-between; margin:0; padding:8px 6px; border-radius:6px; min-height:60px;">
                        <div style="display:flex; align-items:center; gap:6px;">
                            <h4 style="font-size:0.7rem; margin:0;">DATABASE</h4>
                            <div class="status-dot dot-healthy"></div>
                            <span style="font-size:0.75rem;">Healthy</span>
                        </div>
                        <div style="font-size: 0.65rem; color: #6c757d;">Database connection is stable.</div>
                    </div>
                    <div class="health-card" style="display:flex; flex-direction:column; justify-content:space-between; margin:0; padding:8px 6px; border-radius:6px; min-height:60px;">
                        <div style="display:flex; align-items:center; gap:6px;">
                            <h4 style="font-size:0.7rem; margin:0;">API SERVER</h4>
                            <div class="status-dot dot-warning"></div>
                            <span style="font-size:0.75rem;">Degraded</span>
                        </div>
                        <div style="font-size: 0.65rem; color: #6c757d;">Response time is higher than normal.</div>
                    </div>
                    <div class="health-card" style="display:flex; flex-direction:column; justify-content:space-between; margin:0; padding:8px 6px; border-radius:6px; min-height:60px;">
                        <div style="display:flex; align-items:center; gap:6px;">
                            <h4 style="font-size:0.7rem; margin:0;">NODE SYNC</h4>
                            <div class="status-dot dot-error"></div>
                            <span style="font-size:0.75rem;">Unhealthy</span>
                        </div>
                        <div style="font-size: 0.65rem; color: #6c757d;">Node is out of sync with the network.</div>
                    </div>
                    <div class="health-card" style="display:flex; flex-direction:column; justify-content:space-between; margin:0; padding:8px 6px; border-radius:6px; min-height:60px;">
                        <div style="display:flex; align-items:center; gap:6px;">
                            <h4 style="font-size:0.7rem; margin:0;">DISK SPACE</h4>
                            <div class="status-dot dot-healthy"></div>
                            <span style="font-size:0.75rem;">Healthy</span>
                        </div>
                        <div style="font-size: 0.65rem; color: #6c757d;">80% disk space available.</div>
                    </div>
                    <div class="health-card" style="display:flex; flex-direction:column; justify-content:space-between; margin:0; padding:8px 6px; border-radius:6px; min-height:60px;">
                        <div style="display:flex; align-items:center; gap:6px;">
                            <h4 style="font-size:0.7rem; margin:0;">MEMORY USAGE</h4>
                            <div class="status-dot dot-healthy"></div>
                            <span style="font-size:0.75rem;">Healthy</span>
                        </div>
                        <div style="font-size: 0.65rem; color: #6c757d;">Memory usage within normal range.</div>
                    </div>
                    <div class="health-card" style="display:flex; flex-direction:column; justify-content:space-between; margin:0; padding:8px 6px; border-radius:6px; min-height:60px;">
                        <div style="display:flex; align-items:center; gap:6px;">
                            <h4 style="font-size:0.7rem; margin:0;">CPU USAGE</h4>
                            <div class="status-dot dot-warning"></div>
                            <span style="font-size:0.75rem;">Degraded</span>
                        </div>
                        <div style="font-size: 0.65rem; color: #6c757d;">CPU load is higher than normal.</div>
                    </div>
                    <div class="health-card" style="display:flex; flex-direction:column; justify-content:space-between; margin:0; padding:8px 6px; border-radius:6px; min-height:60px;">
                        <div style="display:flex; align-items:center; gap:6px;">
                            <h4 style="font-size:0.7rem; margin:0;">NETWORK CONNECTIVITY</h4>
                            <div class="status-dot dot-healthy"></div>
                            <span style="font-size:0.75rem;">Healthy</span>
                        </div>
                        <div style="font-size:0.65rem; color: #6c757d;">Node can reach peers and internet.</div>
                    </div>
                    <div class="health-card" style="display:flex; flex-direction:column; justify-content:space-between; margin:0; padding:8px 6px; border-radius:6px; min-height:60px;">
                        <div style="display:flex; align-items:center; gap:6px;">
                            <h4 style="font-size:0.7rem; margin:0;">PEER COUNT</h4>
                            <div class="status-dot dot-warning"></div>
                            <span style="font-size:0.75rem;">Degraded</span>
                        </div>
                        <div style="font-size: 0.65rem; color: #6c757d;">Peer count is below optimal.</div>
                    </div>
                    <div class="health-card" style="display:flex; flex-direction:column; justify-content:space-between; margin:0; padding:8px 6px; border-radius:6px; min-height:60px;">
                        <div style="display:flex; align-items:center; gap:6px;">
                            <h4 style="font-size:0.7rem; margin:0;">BLOCK PROPAGATION</h4>
                            <div class="status-dot dot-healthy"></div>
                            <span style="font-size:0.75rem;">Healthy</span>
                        </div>
                        <div style="font-size: 0.65rem; color: #6c757d;">Block propagation time is normal.</div>
                    </div>
                    <div class="health-card" style="display:flex; flex-direction:column; justify-content:space-between; margin:0; padding:8px 6px; border-radius:6px; min-height:60px;">
                        <div style="display:flex; align-items:center; gap:6px;">
                            <h4 style="font-size:0.7rem; margin:0;">TRANSACTION POOL SIZE</h4>
                            <div class="status-dot dot-healthy"></div>
                            <span style="font-size:0.75rem;">Healthy</span>
                        </div>
                        <div style="font-size: 0.65rem; color: #6c757d;">Transaction pool size is normal.</div>
                    </div>
            </div>
        </div>

        <!-- Alerts -->
            <div class="card top-row" style="min-height:140px; padding:16px 18px; max-width: 500px; height:100%;">
                <h3 style="font-size:1.1rem;">üö® System Alerts</h3>
                <div class="alert-list" id="alert-list" style="display: flex; flex-direction: column; gap: 8px;">
                    <!-- Critical Alerts Section -->
                    <div style="margin-bottom: 4px;">
                        <div style="font-weight:600; color:#721c24; font-size:0.9rem; margin-bottom:2px;">Critical</div>
                        <div class="alert-item" style="padding:7px 9px; font-size:0.75rem; margin-bottom:4px; background:#f5c6cb; color:#721c24;">
                            <div class="alert-header" style="margin-bottom:4px;">
                                <span class="alert-level level-critical" style="font-size:0.6rem;">CRITICAL</span>
                                <span class="alert-time" style="font-size:0.65rem;">No critical alerts</span>
            </div>
                            <div class="alert-message" style="font-size:0.75rem;">No critical issues detected.</div>
        </div>
            </div>
                    <!-- Error Alerts Section -->
                    <div style="margin-bottom: 4px;">
                        <div style="font-weight:600; color:#dc3545; font-size:0.9rem; margin-bottom:2px;">Error</div>
                        <div class="alert-item" style="padding:7px 9px; font-size:0.75rem; margin-bottom:4px;">
                            <div class="alert-header" style="margin-bottom:4px;">
                                <span class="alert-level level-error" style="font-size:0.6rem;">ERROR</span>
                                <span class="alert-time" style="font-size:0.65rem;">2024-07-25 14:32:10</span>
                </div>
                            <div class="alert-message" style="font-size:0.75rem;">Node lost connection to peer 192.168.1.10</div>
                            <small style="color: #28a745; font-size:0.65rem;">‚úì Acknowledged</small>
                </div>
                </div>
                    <!-- Warning Alerts Section -->
                    <div style="margin-bottom: 4px;">
                        <div style="font-weight:600; color:#856404; font-size:0.9rem; margin-bottom:2px;">Warning</div>
                        <div class="alert-item" style="padding:7px 9px; font-size:0.75rem; margin-bottom:4px;">
                            <div class="alert-header" style="margin-bottom:4px;">
                                <span class="alert-level level-warning" style="font-size:0.6rem;">WARNING</span>
                                <span class="alert-time" style="font-size:0.65rem;">2024-07-25 13:58:44</span>
                </div>
                            <div class="alert-message" style="font-size:0.75rem;">API response time exceeded 2s threshold</div>
                </div>
            </div>
                    <!-- Info Alerts Section -->
                    <div style="margin-bottom: 0;">
                        <div style="font-weight:600; color:#0c5460; font-size:0.9rem; margin-bottom:2px;">Info</div>
                        <div class="alert-item" style="padding:7px 9px; font-size:0.75rem; margin-bottom:4px;">
                            <div class="alert-header" style="margin-bottom:4px;">
                                <span class="alert-level level-info" style="font-size:0.6rem;">INFO</span>
                                <span class="alert-time" style="font-size:0.65rem;">2024-07-25 13:00:00</span>
        </div>
                            <div class="alert-message" style="font-size:0.75rem;">Scheduled maintenance completed successfully</div>
                </div>
            </div>
        </div>
            </div>
            
            <!-- Trends Section -->
            <div class="card top-row" style="min-height:140px; padding:16px 18px; max-width: 500px; height:100%;">
                <h3 style="font-size:1.1rem;">üìä Performance Trends</h3>
                <p style="font-size:0.85rem; color:#6c757d; margin-bottom:12px;">Real-time trend analysis of key metrics</p>
                <div id="trends-container" class="trends-grid" style="display: flex; flex-direction: column; gap: 8px;">
                    <!-- Trends will be populated here -->
                </div>
            </div>
            
            <!-- Performance Metrics & Analytics (merged, expanded width) -->
            <div class="card" style="grid-column: span 3; min-width: 800px; min-height:140px; height:100%;">
                <h3>üìà Performance Metrics & Analytics</h3>
                <div class="grid" id="metrics-grid">
                    <!-- Metrics will be populated here -->
                </div>
                <div class="charts-row" style="display: flex; flex-direction: row; gap: 16px; margin-top: 10px;">
                    <div class="chart-container" style="flex:1; min-width:0; min-height:100px; display:flex; flex-direction:column; align-items:center;">
                        <h3 style="font-size:1rem;">Transaction Throughput (TPS)</h3>
                        <div class="chart-placeholder" style="height: 120px; display: flex; align-items: center; justify-content: center;">
                            <!-- Mock Line Chart -->
                            <svg width="100%" height="100" viewBox="0 0 180 100">
                                <polyline fill="none" stroke="#667eea" stroke-width="3" points="0,80 20,60 40,70 60,30 80,40 100,20 120,50 140,30 160,60 180,40" />
                                <rect x="0" y="0" width="180" height="100" fill="none" stroke="#e2e8f0" stroke-width="2" />
                            </svg>
            </div>
        </div>
                    <div class="chart-container" style="flex:1; min-width:0; min-height:100px; display:flex; flex-direction:column; align-items:center;">
                        <h3 style="font-size:1rem;">Block Time Distribution</h3>
                        <div class="chart-placeholder" style="height: 120px; display: flex; align-items: center; justify-content: center;">
                            <!-- Mock Bar Chart -->
                            <svg width="100%" height="100" viewBox="0 0 180 100">
                                <rect x="10" y="60" width="15" height="40" fill="#764ba2" />
                                <rect x="35" y="40" width="15" height="60" fill="#764ba2" />
                                <rect x="60" y="20" width="15" height="80" fill="#764ba2" />
                                <rect x="85" y="50" width="15" height="50" fill="#764ba2" />
                                <rect x="110" y="70" width="15" height="30" fill="#764ba2" />
                                <rect x="135" y="55" width="15" height="45" fill="#764ba2" />
                                <rect x="0" y="0" width="180" height="100" fill="none" stroke="#e2e8f0" stroke-width="2" />
                            </svg>
                </div>
                </div>
                    <div class="chart-container" style="flex:1; min-width:0; min-height:100px; display:flex; flex-direction:column; align-items:center;">
                        <h3 style="font-size:1rem;">Resource Usage</h3>
                        <div class="chart-placeholder" style="height: 120px; display: flex; align-items: center; justify-content: center;">
                            <!-- Mock Pie Chart -->
                            <svg width="100" height="100" viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="40" fill="#f8f9fa" stroke="#e2e8f0" stroke-width="2" />
                                <path d="M50,50 L50,10 A40,40 0 0,1 90,50 Z" fill="#667eea" />
                                <path d="M50,50 L90,50 A40,40 0 0,1 50,90 Z" fill="#764ba2" />
                                <path d="M50,50 L50,90 A40,40 0 0,1 10,50 Z" fill="#6c757d" />
                                <path d="M50,50 L10,50 A40,40 0 0,1 50,10 Z" fill="#f1c40f" />
                            </svg>
                </div>
                    </div>
                </div>
            </div>
            
            <!-- Merged Test Environment & Testing Section -->
            <div class="card" style="min-width: 300px; max-width: 500px; min-height:140px; padding:16px 18px; display:flex; flex-direction:column; align-items:center; grid-column: 4;">
                <h3>üß™ Tests</h3>
                <div style="display:flex; flex-direction:row; gap:12px; justify-content:center; align-items:center; margin-bottom: 10px;">
                    <button class="btn btn-primary" onclick="startTestEnvironment()" style="font-size: 0.9rem; padding: 8px 16px; min-width:120px;">Start Test Environment</button>
                    <button class="btn btn-secondary" onclick="stopTestEnvironment()" style="font-size: 0.9rem; padding: 8px 16px; min-width:120px;">Stop Test Environment</button>
                </div>
                <div style="width:100%; margin-bottom: 12px;">
                    <div style="background:#f7fafc; border-radius:8px; border:1px solid #e9ecef; display:flex; flex-direction:row; justify-content:space-between; align-items:center; padding:10px 0; gap:8px;">
                        <div style="flex:1; text-align:center;">
                            <span id="test-nodes" style="font-size:1rem; font-weight:600; color:#667eea;">3</span>
                            <div style="font-size:0.75rem; color:#6c757d;">Nodes</div>
                        </div>
                        <div style="flex:1; text-align:center;">
                            <span id="test-wallets" style="font-size:1rem; font-weight:600; color:#667eea;">5</span>
                            <div style="font-size:0.75rem; color:#6c757d;">Wallets</div>
                        </div>
                        <div style="flex:1; text-align:center;">
                            <span id="test-transactions" style="font-size:1rem; font-weight:600; color:#667eea;">12</span>
                            <div style="font-size:0.75rem; color:#6c757d;">Txs</div>
                        </div>
                        <div style="flex:1; text-align:center;">
                            <span id="test-blocks" style="font-size:1rem; font-weight:600; color:#667eea;">8</span>
                            <div style="font-size:0.75rem; color:#6c757d;">Blocks</div>
                        </div>
                    </div>
                </div>
                <div class="test-type-grid" style="display: flex; flex-direction: row; gap: 10px; width: 100%; margin-bottom: 14px; justify-content: center; align-items: center;">
                    <button class="btn btn-primary" style="flex:1; min-width:0; font-size:0.85rem; padding:8px 0;" onclick="runAutomatedTests()">Automated Tests</button>
                    <button class="btn btn-secondary" style="flex:1; min-width:0; font-size:0.85rem; padding:8px 0;" onclick="runPerformanceTests()">Performance Tests</button>
                    <button class="btn btn-secondary" style="flex:1; min-width:0; font-size:0.85rem; padding:8px 0;" onclick="runSecurityTests()">Security Tests</button>
                    <button class="btn btn-secondary" style="flex:1; min-width:0; font-size:0.85rem; padding:8px 0;" onclick="runIntegrationTests()">Integration Tests</button>
                </div>
                <div id="test-results" style="margin-top: 0; width:100%; flex:1; display:flex;">
                    <div style="background:#f8f9fa; border-radius:8px; border:1px solid #e9ecef; font-size: 0.9rem; color: #666; text-align: center; padding: 16px; width:100%; display:flex; align-items:center; justify-content:center; min-height:60px;">
                        Click a test button to run tests and view results
            </div>
                </div>
            </div>

            <!-- Performance Charts -->
            <!-- (Removed as they are now merged above) -->
        </div>

        <!-- Blockchain Backup System - Full Width -->
        <div class="card" style="margin-bottom: 20px;">
            <h2 class="panel-title">üîÑ Blockchain Backup System</h2>
            
            <!-- Backup Dashboard - Horizontal Layout -->
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div class="backup-card">
                    <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem; display: flex; align-items: center; gap: 10px;">
                        <span class="status-indicator" id="backup-status-indicator"></span>
                        System Status
                    </h3>
                    <div id="backup-status-metrics">
                        <div class="loading">Loading status...</div>
                    </div>
                    <button class="btn" onclick="refreshBackupStatus()" style="margin-top: 10px; font-size: 0.85rem;">
                        üîÑ Refresh Status
                    </button>
                </div>

                <div class="backup-card">
                    <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">üìä Backup Statistics</h3>
                    <div id="backup-stats">
                        <div class="loading">Loading statistics...</div>
                    </div>
                </div>

                <div class="backup-card">
                    <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">‚öôÔ∏è Manual Controls</h3>
                    <p style="margin-bottom: 15px; color: #666; font-size: 0.9rem;">
                        Create a manual backup of the current blockchain state
                    </p>
                    <button class="btn" id="create-backup-btn" onclick="createBackup()" style="font-size: 0.85rem;">
                        üì¶ Create Manual Backup
                    </button>
                </div>
            </div>

            <!-- Backup History -->
            <div>
                <h3 style="margin-bottom: 15px; color: #667eea; font-size: 1.1rem;">
                    üìã Backup History
                    <button class="btn" onclick="refreshBackups()" style="width: auto; margin-left: 10px; font-size: 0.85rem;">
                        üîÑ Refresh
                    </button>
                </h3>
                <div id="backup-list">
                    <div class="loading">Loading backup list...</div>
                </div>
            </div>
        </div>

        <div id="backup-alerts"></div>

        <!-- Privacy & Security Section -->
        <div class="card" style="margin-bottom: 20px;">
            <h2 class="panel-title">üîí Privacy & Security</h2>
            <div class="privacy-section">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; grid-template-rows: auto auto auto;">
                    <div class="privacy-card" style="background: #f8f9fa; border-radius: 10px; padding: 15px; border: 1px solid #e9ecef;">
                        <h4 style="color: #1e3c72; margin-bottom: 10px; font-size: 1rem;">üîê Data Encryption</h4>
                        <div class="form-group" style="margin-bottom: 8px;">
                            <label for="encrypt-data" style="font-size: 0.85rem; font-weight: 500;">Data to Encrypt:</label>
                            <textarea id="encrypt-data" class="form-control" rows="3" placeholder="Enter sensitive data to encrypt..." style="font-size: 0.85rem;"></textarea>
                        </div>
                        <div class="form-group" style="margin-bottom: 8px;">
                            <label for="encrypt-password" style="font-size: 0.85rem; font-weight: 500;">Password (optional):</label>
                            <input type="password" id="encrypt-password" class="form-control" placeholder="Leave empty for random key" style="font-size: 0.85rem;">
                        </div>
                        <button onclick="encryptData()" class="btn" style="font-size: 0.85rem; padding: 8px 12px;">üîê Encrypt</button>
                        <div id="encrypt-result" class="result" style="display: none; margin-top: 10px;"></div>
                    </div>
                    <div class="privacy-card" style="background: #f8f9fa; border-radius: 10px; padding: 15px; border: 1px solid #e9ecef;">
                        <h4 style="color: #1e3c72; margin-bottom: 10px; font-size: 1rem;">üîì Data Decryption</h4>
                        <div class="form-group" style="margin-bottom: 8px;">
                            <label for="decrypt-data" style="font-size: 0.85rem; font-weight: 500;">Encrypted Data:</label>
                            <textarea id="decrypt-data" class="form-control" rows="3" placeholder="Enter encrypted data..." style="font-size: 0.85rem;"></textarea>
                        </div>
                        <div class="form-group" style="margin-bottom: 8px;">
                            <label for="decrypt-password" style="font-size: 0.85rem; font-weight: 500;">Password:</label>
                            <input type="password" id="decrypt-password" class="form-control" placeholder="Enter decryption password" style="font-size: 0.85rem;">
                        </div>
                        <button onclick="decryptData()" class="btn" style="font-size: 0.85rem; padding: 8px 12px;">üîì Decrypt</button>
                        <div id="decrypt-result" class="result" style="display: none; margin-top: 10px;"></div>
                    </div>
                    <div class="privacy-card" style="background: #f8f9fa; border-radius: 10px; padding: 15px; border: 1px solid #e9ecef;">
                        <h4 style="color: #1e3c72; margin-bottom: 10px; font-size: 1rem;">üîç Zero-Knowledge Proofs</h4>
                        <div class="form-group" style="margin-bottom: 8px;">
                            <label for="proof-data" style="font-size: 0.85rem; font-weight: 500;">Data for Proof:</label>
                            <textarea id="proof-data" class="form-control" rows="3" placeholder="Enter data to create zero-knowledge proof..." style="font-size: 0.85rem;"></textarea>
                        </div>
                        <button onclick="createProof()" class="btn" style="font-size: 0.85rem; padding: 8px 12px;">üîç Create Proof</button>
                        <div id="proof-result" class="result" style="display: none; margin-top: 10px;"></div>
                    </div>
                    <div class="privacy-card" style="background: #f8f9fa; border-radius: 10px; padding: 15px; border: 1px solid #e9ecef;">
                        <h4 style="color: #1e3c72; margin-bottom: 10px; font-size: 1rem;">‚úÖ Proof Verification</h4>
                        <div class="form-group" style="margin-bottom: 8px;">
                            <label for="verify-proof" style="font-size: 0.85rem; font-weight: 500;">Proof to Verify:</label>
                            <textarea id="verify-proof" class="form-control" rows="3" placeholder="Enter proof to verify..." style="font-size: 0.85rem;"></textarea>
                        </div>
                        <button onclick="verifyProof()" class="btn" style="font-size: 0.85rem; padding: 8px 12px;">‚úÖ Verify Proof</button>
                        <div id="verify-result" class="result" style="display: none; margin-top: 10px;"></div>
                    </div>
                    <div class="privacy-card" style="background: #f8f9fa; border-radius: 10px; padding: 15px; border: 1px solid #e9ecef; grid-column: 1 / span 2;">
                        <h4 style="color: #1e3c72; margin-bottom: 10px; font-size: 1rem;">üóëÔ∏è GDPR Compliance</h4>
                        <div class="form-group" style="margin-bottom: 8px;">
                            <label for="gdpr-address" style="font-size: 0.85rem; font-weight: 500;">User Address:</label>
                            <input type="text" id="gdpr-address" class="form-control" placeholder="Enter user address for GDPR operations" style="font-size: 0.85rem;">
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="gdprDelete()" class="btn" style="font-size: 0.85rem; padding: 8px 12px;">üóëÔ∏è Delete Data</button>
                            <button onclick="gdprAnonymize()" class="btn" style="font-size: 0.85rem; padding: 8px 12px;">üë§ Anonymize Data</button>
                        </div>
                        <div id="gdpr-result" class="result" style="display: none; margin-top: 10px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="status" class="status"></div>

    <script>
        const API_BASE = `http://localhost:${window.currentApiPort || 8080}`;
        
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.classList.add('show');
            setTimeout(() => status.classList.remove('show'), 3000);
        }
        
        async function loadSystemStatus() {
            try {
                const response = await fetch(`${API_BASE}/monitoring/status`);
                const data = await response.json();
                
                if (response.ok) {
                    displaySystemOverview(data);
                    showStatus('System status loaded successfully!', 'success');
                } else {
                    throw new Error(data.error || 'Failed to load system status');
                }
            } catch (error) {
                showStatus('Failed to load system status: ' + error.message, 'error');
            }
        }
        
        function displaySystemOverview(data) {
            // Update uptime and version
            document.getElementById('uptime').textContent = `Uptime: ${data.uptime}`;
            document.getElementById('version').textContent = `Version: ${data.version}`;
            
            // Display key metrics
            displayMetrics(data.performance);
            
            // Display health checks
            displayHealthChecks(data.health_checks);
            
            // Display alerts
            displayAlerts(data.alerts);
        }
        
        function displayMetrics(performance) {
            const grid = document.getElementById('metrics-grid');
            grid.innerHTML = '';
            
            const metrics = [
                { key: 'tps', label: 'Transactions/sec', unit: 'TPS' },
                { key: 'block_time', label: 'Block Time', unit: 's' },
                { key: 'memory_usage', label: 'Memory Usage', unit: 'MB' },
                { key: 'cpu_usage', label: 'CPU Usage', unit: '%' },
                { key: 'network_latency', label: 'Network Latency', unit: 'ms' },
                { key: 'active_peers', label: 'Active Peers', unit: '' },
                { key: 'validator_count', label: 'Validators', unit: '' },
                { key: 'pending_transactions', label: 'Pending Tx', unit: '' },
                { key: 'block_height', label: 'Block Height', unit: '' },
                { key: 'total_staked', label: 'Total Staked', unit: ' tokens' },
                { key: 'average_block_size', label: 'Avg Block Size', unit: 'KB' },
                { key: 'gas_price', label: 'Gas Price', unit: '' },
                { key: 'contract_count', label: 'Contracts', unit: '' },
            ];
            
            metrics.forEach(metric => {
                const value = performance[metric.key] || 0;
                const card = document.createElement('div');
                card.className = 'metric-card';
                
                card.innerHTML = `
                    <div class="metric-value">${value}${metric.unit}</div>
                    <div class="metric-label">${metric.label}</div>
                    <div class="metric-status status-healthy">Healthy</div>
                `;
                
                grid.appendChild(card);
            });
        }
        
        function displayHealthChecks(healthChecks) {
            const grid = document.getElementById('health-grid');
            grid.innerHTML = '';
            
            healthChecks.forEach(check => {
                const card = document.createElement('div');
                card.className = 'health-card';
                
                const statusClass = check.status === 'healthy' ? 'dot-healthy' : 
                                  check.status === 'degraded' ? 'dot-warning' : 'dot-error';
                const statusText = check.status === 'healthy' ? 'Healthy' : 
                                 check.status === 'degraded' ? 'Degraded' : 'Unhealthy';
                
                card.innerHTML = `
                    <h4>${check.name.replace(/_/g, ' ').toUpperCase()}</h4>
                    <div class="health-status">
                        <div class="status-dot ${statusClass}"></div>
                        <span>${statusText}</span>
                    </div>
                    <div style="font-size: 0.9rem; color: #6c757d;">
                        ${check.message}
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }
        
        function displayAlerts(alerts) {
            const list = document.getElementById('alert-list');
            list.innerHTML = '';
            
            if (alerts.length === 0) {
                // This section is now handled by the JS logic that displays mock alerts
                // based on the current time and a placeholder message.
                // The JS will update the content of the alert-list div.
                return;
            }
            
            // Sort alerts by level (critical, error, warning, info)
            const sortedAlerts = alerts.sort((a, b) => {
                const levels = ['critical', 'error', 'warning', 'info'];
                return levels.indexOf(a.level) - levels.indexOf(b.level);
            });

            sortedAlerts.forEach(alert => {
                const item = document.createElement('div');
                item.className = 'alert-item';
                
                const levelClass = `level-${alert.level}`;
                const time = new Date(alert.timestamp * 1000).toLocaleString();
                
                item.innerHTML = `
                    <div class="alert-header">
                        <span class="alert-level ${levelClass}">${alert.level.toUpperCase()}</span>
                        <span class="alert-time">${time}</span>
                    </div>
                    <div class="alert-message">${alert.message}</div>
                    ${alert.acknowledged ? '<small style="color: #28a745;">‚úì Acknowledged</small>' : ''}
                `;
                
                list.appendChild(item);
            });
        }
        
        async function loadTrends() {
            try {
                const response = await fetch(`${API_BASE}/monitoring/trends`);
                const data = await response.json();
                
                if (response.ok) {
                    displayTrends(data.trends);
                } else {
                    throw new Error(data.error || 'Failed to load trends');
                }
            } catch (error) {
                console.error('Failed to load trends:', error);
            }
        }
        
        function displayTrends(trends) {
            const trendsContainer = document.getElementById('trends-container');
            if (!trendsContainer) return;
            
            trendsContainer.innerHTML = '';
            
            const trendItems = [
                { key: 'tps_trend', label: 'TPS Trend', icon: 'üìà' },
                { key: 'memory_trend', label: 'Memory Trend', icon: 'üíæ' },
                { key: 'cpu_trend', label: 'CPU Trend', icon: '‚ö°' },
            ];
            
            trendItems.forEach(item => {
                const trend = trends[item.key] || 'stable';
                const card = document.createElement('div');
                card.className = `trend-card trend-${trend}`;
                
                card.innerHTML = `
                    <div class="trend-icon">${item.icon}</div>
                    <div class="trend-label">${item.label}</div>
                    <div class="trend-value">${trend}</div>
                `;
                
                trendsContainer.appendChild(card);
            });
            
            // Add data points info
            const dataPoints = document.createElement('div');
            dataPoints.className = 'data-points-info';
            dataPoints.innerHTML = `Data points: ${trends.data_points || 0}`;
            trendsContainer.appendChild(dataPoints);
        }
        
        async function loadBlockchainStatus() {
            try {
                const response = await fetch(`${API_BASE}/status`);
                const data = await response.json();
                
                if (response.ok) {
                    // Update enhanced network statistics grid
                    document.getElementById('total-blocks').textContent = data.blockHeight || data.block_height || 'N/A';
                    document.getElementById('total-transactions').textContent = data.total_transactions || data.pendingTransactions || 'N/A';
                    document.getElementById('active-validators').textContent = data.active_validators || 'N/A';
                    document.getElementById('pool-size').textContent = data.pool_size || 'N/A';
                    
                    // Update connection status
                    const statusIndicator = document.querySelector('.status-indicator');
                    statusIndicator.className = 'status-indicator status-online';
                    statusIndicator.nextSibling.textContent = 'Connected';
                    
                    showStatus('Blockchain status updated!', 'success');
                } else {
                    throw new Error(data.error || 'Failed to load blockchain status');
                }
            } catch (error) {
                showStatus('Failed to load blockchain status: ' + error.message, 'error');
            }
        }
        
        async function loadRecentBlocks() {
            try {
                const response = await fetch(`${API_BASE}/blocks`);
                const blocks = await response.json();
                
                if (response.ok) {
                    const container = document.getElementById('recent-blocks');
                    container.innerHTML = '';
                    
                    blocks.slice(-5).reverse().forEach(block => {
                        const blockItem = document.createElement('div');
                        blockItem.className = 'block-item';
                        
                        blockItem.innerHTML = `
                            <div class="block-header">
                                <span class="block-number">Block #${block.index}</span>
                                <span class="block-hash">${block.hash.substring(0, 16)}...</span>
                            </div>
                            <div>Transactions: ${block.transactions.length}</div>
                            <div>Validator: ${block.validator.substring(0, 16)}...</div>
                        `;
                        
                        container.appendChild(blockItem);
                    });
                } else {
                    throw new Error('Failed to load blocks');
                }
            } catch (error) {
                showStatus('Failed to load recent blocks: ' + error.message, 'error');
            }
        }
        
        async function loadRecentTransactions() {
            try {
                const response = await fetch(`${API_BASE}/mempool`);
                const transactions = await response.json();
                
                if (response.ok) {
                    const container = document.getElementById('recent-transactions');
                    container.innerHTML = '';
                    
                    if (transactions.length === 0) {
                        container.innerHTML = '<div class="transaction-item" style="padding: 4px 0; color: #6c757d;">No recent transactions</div>';
                        return;
                    }
                    
                    transactions.slice(0, 5).forEach(tx => {
                        const txItem = document.createElement('div');
                        txItem.className = 'transaction-item';
                        txItem.style.cssText = 'padding: 4px 0; border-bottom: 1px solid #f1f3f4; cursor: pointer;';
                        txItem.onclick = () => showTransactionDetail(tx);
                        
                        const timestamp = new Date(tx.Timestamp * 1000).toLocaleTimeString();
                        
                        txItem.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="font-weight: 500; color: #495057;">${tx.Sender.substring(0, 12)}...</div>
                                <div style="color: #28a745; font-weight: 500;">${tx.Amount} tokens</div>
                            </div>
                            <div style="font-size: 0.65rem; color: #6c757d; margin-top: 2px;">
                                To: ${tx.Recipient.substring(0, 12)}... | ${timestamp}
                            </div>
                        `;
                        
                        container.appendChild(txItem);
                    });
                } else {
                    throw new Error('Failed to load transactions');
                }
            } catch (error) {
                const container = document.getElementById('recent-transactions');
                container.innerHTML = '<div class="transaction-item" style="padding: 4px 0; color: #dc3545;">Error loading transactions</div>';
            }
        }
        
        function showTransactionDetail(tx) {
            const timestamp = new Date(tx.Timestamp * 1000).toLocaleString();
            
            const detailHTML = `
                <div style="padding: 20px; max-width: 500px;">
                    <h3 style="margin-bottom: 20px; color: #2d3748;">Transaction Details</h3>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <div style="margin-bottom: 10px;">
                            <strong>Transaction Hash:</strong>
                            <div style="font-family: monospace; background: #e9ecef; padding: 8px; border-radius: 4px; margin-top: 5px; word-break: break-all;">
                                ${tx.Hash || 'N/A'}
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <strong>From:</strong>
                                <div style="font-family: monospace; background: #e9ecef; padding: 8px; border-radius: 4px; margin-top: 5px; word-break: break-all;">
                                    ${tx.Sender}
                                </div>
                            </div>
                            <div>
                                <strong>To:</strong>
                                <div style="font-family: monospace; background: #e9ecef; padding: 8px; border-radius: 4px; margin-top: 5px; word-break: break-all;">
                                    ${tx.Recipient}
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <strong>Amount:</strong>
                            <div style="font-size: 1.2rem; font-weight: bold; color: #28a745; margin-top: 5px;">
                                ${tx.Amount} tokens
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <strong>Timestamp:</strong>
                            <div style="margin-top: 5px;">${timestamp}</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Create modal or use alert for now
            alert(`Transaction Details:\n\nFrom: ${tx.Sender.substring(0, 20)}...\nTo: ${tx.Recipient.substring(0, 20)}...\nAmount: ${tx.Amount} tokens\nTime: ${timestamp}`);
        }
        
        async function runAutomatedTests() {
            try {
                showStatus('Running automated tests...', 'info');
                const response = await fetch(`${API_BASE}/run-tests`);
                const result = await response.json();
                
                if (response.ok) {
                    displayTestResults(result, 'Automated Tests');
                    showStatus('Automated tests completed successfully!', 'success');
                } else {
                    throw new Error(result.error || 'Tests failed');
                }
            } catch (error) {
                showStatus('Automated tests failed: ' + error.message, 'error');
            }
        }

        async function runPerformanceTests() {
            try {
                showStatus('Running performance tests...', 'info');
                const response = await fetch(`${API_BASE}/test-performance`);
                const result = await response.json();
                
                if (response.ok) {
                    displayTestResults(result, 'Performance Tests');
                    showStatus('Performance tests completed!', 'success');
                } else {
                    throw new Error(result.error || 'Performance tests failed');
                }
            } catch (error) {
                showStatus('Performance tests failed: ' + error.message, 'error');
            }
        }

        async function runSecurityTests() {
            try {
                showStatus('Running security tests...', 'info');
                const response = await fetch(`${API_BASE}/test-security`);
                const result = await response.json();
                
                if (response.ok) {
                    displayTestResults(result, 'Security Tests');
                    showStatus('Security tests completed!', 'success');
                } else {
                    throw new Error(result.error || 'Security tests failed');
                }
            } catch (error) {
                showStatus('Security tests failed: ' + error.message, 'error');
            }
        }

        async function runIntegrationTests() {
            try {
                showStatus('Running integration tests...', 'info');
                const response = await fetch(`${API_BASE}/test-integration`);
                const result = await response.json();
                
                if (response.ok) {
                    displayTestResults(result, 'Integration Tests');
                    showStatus('Integration tests completed!', 'success');
                } else {
                    throw new Error(result.error || 'Integration tests failed');
                }
            } catch (error) {
                showStatus('Integration tests failed: ' + error.message, 'error');
            }
        }

        function displayTestResults(results, testType) {
            const container = document.getElementById('test-results');
            
            let html = `
                <div style="background: #f8f9fa; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                    <h4 style="color: #667eea; margin-bottom: 10px; font-size: 1rem;">${testType} Results</h4>
                    <div style="font-size: 0.85rem; color: #666;">
            `;
            
            if (results.suites) {
                results.suites.forEach(suite => {
                    html += `
                        <div style="margin-bottom: 10px; padding: 8px; background: white; border-radius: 6px;">
                            <div style="font-weight: 600; color: #333;">${suite.name}</div>
                            <div style="font-size: 0.8rem; color: #666; margin: 5px 0;">
                                ${suite.description}
                            </div>
                            <div style="font-size: 0.8rem;">
                                <span style="color: #28a745;">‚úÖ ${suite.passed} passed</span> | 
                                <span style="color: #dc3545;">‚ùå ${suite.failed} failed</span> | 
                                <span style="color: #ffc107;">‚ö†Ô∏è ${suite.warnings} warnings</span>
                            </div>
                        </div>
                    `;
                });
            } else if (results.output) {
                html += `<div style="font-family: monospace; font-size: 0.8rem; white-space: pre-wrap;">${results.output}</div>`;
            } else {
                html += `<div style="color: #28a745;">‚úÖ Tests completed successfully</div>`;
            }
            
            html += `</div></div>`;
            container.innerHTML = html;
        }

        async function startTestEnvironment() {
            try {
                showStatus('Starting test environment...', 'info');
                const response = await fetch(`${API_BASE}/start-test-env`);
                const result = await response.json();
                
                if (response.ok) {
                    showStatus('Test environment started successfully!', 'success');
                    updateTestEnvironmentStatus();
                } else {
                    throw new Error(result.error || 'Failed to start test environment');
                }
            } catch (error) {
                showStatus('Failed to start test environment: ' + error.message, 'error');
            }
        }

        async function stopTestEnvironment() {
            try {
                showStatus('Stopping test environment...', 'info');
                const response = await fetch(`${API_BASE}/stop-test-env`);
                const result = await response.json();
                
                if (response.ok) {
                    showStatus('Test environment stopped successfully!', 'success');
                    updateTestEnvironmentStatus();
                } else {
                    throw new Error(result.error || 'Failed to stop test environment');
                }
            } catch (error) {
                showStatus('Failed to stop test environment: ' + error.message, 'error');
            }
        }

        async function updateTestEnvironmentStatus() {
            try {
                const response = await fetch(`${API_BASE}/test-env-status`);
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('test-nodes').textContent = data.nodes || 0;
                    document.getElementById('test-wallets').textContent = data.wallets || 0;
                    document.getElementById('test-transactions').textContent = data.transactions || 0;
                    document.getElementById('test-blocks').textContent = data.blocks || 0;
                }
            } catch (error) {
                console.log('Could not update test environment status:', error.message);
            }
        }

        async function runTests() {
            await runAutomatedTests();
        }
        
        // Auto-refresh every 30 seconds
        function startAutoRefresh() {
            setInterval(() => {
                loadSystemStatus();
                loadBlockchainStatus();
                loadRecentBlocks();
                loadTrends();
            }, 30000);
        }
        
        // Load initial data
        document.addEventListener('DOMContentLoaded', function() {
            loadSystemStatus();
            loadBlockchainStatus();
            loadRecentTransactions();
            loadRecentBlocks();
            loadTrends();
            updateTestEnvironmentStatus();
            startAutoRefresh();
            
            // Initialize backup system
            refreshBackupStatus();
            refreshBackups();
            
            // Auto-refresh backup data every 30 seconds
            setInterval(() => {
                refreshBackupStatus();
                refreshBackups();
            }, 30000);
            
            // Auto-refresh recent transactions every 30 seconds
            setInterval(() => {
                loadRecentTransactions();
            }, 30000);
        });

        // Backup System Functions
        let isCreatingBackup = false;

        async function refreshBackupStatus() {
            try {
                const response = await fetch(`${API_BASE}/backup/status`);
                const status = await response.json();
                
                updateBackupStatusIndicator(status.status);
                updateBackupStatusMetrics(status);
                updateBackupStats(status);
                
            } catch (error) {
                showBackupError('Failed to load backup status: ' + error.message);
            }
        }

        async function refreshBackups() {
            try {
                const response = await fetch(`${API_BASE}/backup/list`);
                const backups = await response.json();
                
                updateBackupList(backups);
                
            } catch (error) {
                showBackupError('Failed to load backup list: ' + error.message);
            }
        }

        async function createBackup() {
            if (isCreatingBackup) return;
            
            isCreatingBackup = true;
            const btn = document.getElementById('create-backup-btn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Creating Backup...';
            
            try {
                const response = await fetch(`${API_BASE}/backup/create`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    showBackupSuccess('Backup created successfully!');
                    refreshBackupStatus();
                    refreshBackups();
                } else {
                    const error = await response.text();
                    showBackupError('Failed to create backup: ' + error);
                }
            } catch (error) {
                showBackupError('Failed to create backup: ' + error.message);
            } finally {
                isCreatingBackup = false;
                btn.disabled = false;
                btn.textContent = 'üì¶ Create Manual Backup';
            }
        }

        function updateBackupStatusIndicator(status) {
            const indicator = document.getElementById('backup-status-indicator');
            if (!indicator) return;
            
            indicator.className = 'status-indicator';
            if (status === 'active') {
                indicator.classList.add('status-active');
            } else if (status === 'inactive') {
                indicator.classList.add('status-inactive');
            } else {
                indicator.classList.add('status-unknown');
            }
        }

        function updateBackupStatusMetrics(status) {
            const container = document.getElementById('backup-status-metrics');
            if (!container) return;
            
            container.innerHTML = `
                <div style="margin-bottom: 8px;">
                    <strong>Status:</strong> <span style="color: ${status.status === 'active' ? '#27ae60' : '#e74c3c'}">${status.status || 'unknown'}</span>
                </div>
                <div style="margin-bottom: 8px;">
                    <strong>Last Backup:</strong> <span>${status.lastBackup || 'Never'}</span>
                </div>
                <div style="margin-bottom: 8px;">
                    <strong>Next Backup:</strong> <span>${status.nextBackup || 'Not scheduled'}</span>
                </div>
                <div>
                    <strong>Auto Backup:</strong> <span style="color: ${status.autoBackup ? '#27ae60' : '#e74c3c'}">${status.autoBackup ? 'Enabled' : 'Disabled'}</span>
                </div>
            `;
        }

        function updateBackupStats(status) {
            const container = document.getElementById('backup-stats');
            if (!container) return;
            
            container.innerHTML = `
                <div style="margin-bottom: 8px;">
                    <strong>Total Backups:</strong> <span>${status.totalBackups || 0}</span>
                </div>
                <div style="margin-bottom: 8px;">
                    <strong>Total Size:</strong> <span>${status.totalSize || '0 MB'}</span>
                </div>
                <div style="margin-bottom: 8px;">
                    <strong>Verified:</strong> <span style="color: #27ae60">${status.verifiedBackups || 0}</span>
                </div>
                <div>
                    <strong>Corrupted:</strong> <span style="color: #e74c3c">${status.corruptedBackups || 0}</span>
                </div>
            `;
        }

        function updateBackupList(backups) {
            const container = document.getElementById('backup-list');
            if (!container) return;
            
            if (!Array.isArray(backups) || backups.length === 0) {
                container.innerHTML = '<div class="loading">No backups found</div>';
                return;
            }
            
            container.innerHTML = '';
            backups.forEach(backup => {
                const item = document.createElement('div');
                item.className = 'backup-item';
                item.innerHTML = `
                    <div class="backup-id">${backup.id}</div>
                    <div class="backup-timestamp">${backup.timestamp}</div>
                    <div class="backup-size">${backup.size}</div>
                    <div class="backup-status status-${backup.status}">${backup.status}</div>
                `;
                container.appendChild(item);
            });
        }

        function showBackupError(message) {
            const container = document.getElementById('backup-alerts');
            if (!container) return;
            
            const alert = document.createElement('div');
            alert.className = 'error';
            alert.textContent = message;
            container.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        function showBackupSuccess(message) {
            const container = document.getElementById('backup-alerts');
            if (!container) return;
            
            const alert = document.createElement('div');
            alert.className = 'success';
            alert.textContent = message;
            container.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Privacy & Security Functions
        async function encryptData() {
            const data = document.getElementById('encrypt-data').value;
            const password = document.getElementById('encrypt-password').value;
            
            if (!data) {
                showStatus('Please enter data to encrypt', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/privacy/encrypt`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ data, password })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('encrypt-result').innerHTML = 
                        `Encrypted Data:\n${JSON.stringify(result, null, 2)}`;
                    document.getElementById('encrypt-result').className = 'result success';
                    document.getElementById('encrypt-result').style.display = 'block';
                    showStatus('Data encrypted successfully!', 'success');
                } else {
                    throw new Error(result.error || 'Encryption failed');
                }
            } catch (error) {
                showStatus('Encryption failed: ' + error.message, 'error');
            }
        }

        async function decryptData() {
            const encryptedData = document.getElementById('decrypt-data').value;
            const password = document.getElementById('decrypt-password').value;
            
            if (!encryptedData) {
                showStatus('Please enter encrypted data', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/privacy/decrypt`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ encryptedData, password })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('decrypt-result').innerHTML = 
                        `Decrypted Data:\n${JSON.stringify(result, null, 2)}`;
                    document.getElementById('decrypt-result').className = 'result success';
                    document.getElementById('decrypt-result').style.display = 'block';
                    showStatus('Data decrypted successfully!', 'success');
                } else {
                    throw new Error(result.error || 'Decryption failed');
                }
            } catch (error) {
                showStatus('Decryption failed: ' + error.message, 'error');
            }
        }

        async function createProof() {
            const data = document.getElementById('proof-data').value;
            
            if (!data) {
                showStatus('Please enter data for proof', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/privacy/create-proof`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ data })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('proof-result').innerHTML = 
                        `Zero-Knowledge Proof:\n${JSON.stringify(result, null, 2)}`;
                    document.getElementById('proof-result').className = 'result success';
                    document.getElementById('proof-result').style.display = 'block';
                    showStatus('Proof created successfully!', 'success');
                } else {
                    throw new Error(result.error || 'Proof creation failed');
                }
            } catch (error) {
                showStatus('Proof creation failed: ' + error.message, 'error');
            }
        }

        async function verifyProof() {
            const proof = document.getElementById('verify-proof').value;
            
            if (!proof) {
                showStatus('Please enter proof to verify', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/privacy/verify-proof`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ proof })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('verify-result').innerHTML = 
                        `Proof Verification Result:\n${JSON.stringify(result, null, 2)}`;
                    document.getElementById('verify-result').className = 'result success';
                    document.getElementById('verify-result').style.display = 'block';
                    showStatus('Proof verified successfully!', 'success');
                } else {
                    throw new Error(result.error || 'Proof verification failed');
                }
            } catch (error) {
                showStatus('Proof verification failed: ' + error.message, 'error');
            }
        }

        async function gdprDelete() {
            const address = document.getElementById('gdpr-address').value;
            
            if (!address) {
                showStatus('Please enter user address', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/privacy/gdpr-delete`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('gdpr-result').innerHTML = 
                        `GDPR Delete Result:\n${JSON.stringify(result, null, 2)}`;
                    document.getElementById('gdpr-result').className = 'result success';
                    document.getElementById('gdpr-result').style.display = 'block';
                    showStatus('Data deleted successfully!', 'success');
                } else {
                    throw new Error(result.error || 'GDPR delete failed');
                }
            } catch (error) {
                showStatus('GDPR delete failed: ' + error.message, 'error');
            }
        }

        async function gdprAnonymize() {
            const address = document.getElementById('gdpr-address').value;
            
            if (!address) {
                showStatus('Please enter user address', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/privacy/gdpr-anonymize`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('gdpr-result').innerHTML = 
                        `GDPR Anonymize Result:\n${JSON.stringify(result, null, 2)}`;
                    document.getElementById('gdpr-result').className = 'result success';
                    document.getElementById('gdpr-result').style.display = 'block';
                    showStatus('Data anonymized successfully!', 'success');
                } else {
                    throw new Error(result.error || 'GDPR anonymize failed');
                }
            } catch (error) {
                showStatus('GDPR anonymize failed: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html> 